---
import { getRandomKeys } from "../lib/getRandomKeys";

export const prerender = false;

try {
  const articles = Astro.locals.runtime?.env?.ARTICLES;
  if (articles) {
    const randomKey = await getRandomKeys({
      kv: articles,
      indexKey: "articles",
      indices: Astro.locals.runtime?.env?.INDICES,
      count: 1,
    }).then((keys) => keys[0]);

    if (randomKey?.name) {
      return Astro.redirect(`/${randomKey.name}`);
    }
  }
} catch (error) {
  console.error("Error fetching random article:", error);
}

// Default to home page if anything fails
return Astro.redirect("/");
---
